<div class="shop-container">
  <shoppingcart
    [isCartOpen]="isCartOpen"
    [closeCart]="closeCart.bind(this)"
  ></shoppingcart>

  <div class="toast-message" *ngIf="toastVisible">
    <span class="material-icons toast-icon">check_circle</span>
    <span class="toast-text">{{ toastText }}</span>
    <div class="toast-progress"></div>
  </div>

  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <div class="header-left">
        <div class="logo">TechShop</div>
        <nav class="nav">
          <a href="home" class="nav-link">Home</a>
          <a href="shop" class="nav-link active">Shop</a>
          <a href="#" class="nav-link">Categories</a>
          <a href="#" class="nav-link">Deals</a>
        </nav>
      </div>

      <div class="header-right">
        <div class="search-box">
          <input
            type="text"
            [(ngModel)]="searchKeyword"
            (ngModelChange)="onSearchInput($event)"
            placeholder="Search products..."
            class="search-input"
          />
          <span class="material-icons search-icon">search</span>
        </div>
        <button class="icon-btn">
          <span class="material-icons icon">favorite_border</span>
        </button>
        <button
          class="icon-btn cart-btn"
          data-cy="open-cart"
          (click)="isCartOpen = !isCartOpen"
        >
          <span class="material-icons icon">shopping_cart</span>
          <span class="cart-badge">{{ cartItems }}</span>
        </button>
        <button class="icon-btn">
          <span class="material-icons icon">person</span>
        </button>
      </div>
    </div>
  </header>

  <div class="main-content">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-section">
        <h3 class="sidebar-title">Browse Categories</h3>

        <div class="categories-list">
          <div *ngFor="let category of categories" class="category-item">
            <button
              (click)="toggleCategory(category.id)"
              class="category-btn"
              [class.expanded]="category.expanded"
            >
              <div class="category-info">
                <span class="category-icon">{{ category.icon }}</span>
                <span class="category-name">{{ category.name }}</span>
              </div>
              <span
                class="material-icons expand-icon"
                [class.rotated]="category.expanded"
                >chevron_right</span
              >
            </button>
          </div>
        </div>
      </div>

      <!-- Filters -->
      <div class="sidebar-section">
        <h4 class="filter-title">
          <span class="material-icons filter-icon">tune</span>
          Filters
        </h4>

        <!-- Price Range -->
        <div class="filter-group">
          <h5 class="filter-label">Price</h5>
          <div class="price-inputs">
            <input
              type="number"
              [(ngModel)]="priceRange[0]"
              (input)="onPriceRangeChange($event)"
              class="price-input"
              min="0"
            />
            <span class="price-separator">-</span>
            <input
              type="number"
              [(ngModel)]="priceRange[1]"
              (input)="onPriceRangeChange($event)"
              class="price-input"
              min="0"
            />
          </div>
          <input
            type="range"
            min="0"
            max="50000000"
            [value]="priceRange[1]"
            (input)="onPriceRangeChange($event)"
            class="price-range"
          />
        </div>

        <!-- Latest Products -->
        <div class="filter-group">
          <h5 class="filter-label">Latest Products</h5>
          <div class="latest-products">
            <div *ngFor="let product of latestProducts" class="latest-product">
              <div class="latest-product-image">
                <img
                  [src]="product.image"
                  [alt]="product.name"
                  class="latest-product-image-img"
                />
              </div>
              <div class="latest-product-info">
                <p class="latest-product-name">{{ product.name }}</p>
                <div class="latest-product-price">
                  <span class="current-price"
                    >{{ product.minPrice.toLocaleString("vi-VN") }} -
                    {{ product.maxPrice.toLocaleString("vi-VN") }} ₫</span
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="content">
      <div class="content-header">
        <h1 class="page-title">Shop</h1>

        <div class="content-controls">
          <div class="view-controls">
            <button
              (click)="setViewMode('grid')"
              class="view-btn"
              [class.active]="viewMode === 'grid'"
            >
              <span class="material-icons view-icon">grid_view</span>
            </button>
            <button
              (click)="setViewMode('list')"
              class="view-btn"
              [class.active]="viewMode === 'list'"
            >
              <span class="material-icons view-icon">list</span>
            </button>
          </div>

          <div class="sort-controls">
            <select
              [value]="sortBy"
              (change)="onSortChange($event)"
              class="sort-select"
            >
              <option *ngFor="let option of sortOptions" [value]="option">
                {{ option }}
              </option>
            </select>

            <select
              [value]="itemsPerPage"
              (change)="onItemsPerPageChange($event)"
              class="items-select"
            >
              <option
                *ngFor="let option of itemsPerPageOptions"
                [value]="option"
              >
                {{ option }}
              </option>
            </select>
          </div>
        </div>
      </div>

      <!-- Products Grid -->
      <div class="products-grid" [class.list-view]="viewMode === 'list'">
        <div *ngFor="let product of filteredProducts" class="product-card">
          <div class="product-image-container">
            <img
              [src]="product.image"
              [alt]="product.name"
              class="product-image"
            />
            <div
              *ngIf="product.badge"
              class="product-badge"
              [ngClass]="'badge-' + product.badgeColor"
            >
              {{ product.badge }}
            </div>
            <div class="product-overlay">
              <button
                (click)="addToWishlist(product)"
                class="overlay-btn wishlist-btn"
              >
                <span class="material-icons">favorite_border</span>
              </button>
              <button (click)="addToCart(product)" class="overlay-btn cart-btn">
                <span class="material-icons">shopping_cart</span>
              </button>
            </div>
          </div>

          <div class="product-info">
            <h3 class="product-name">{{ product.name }}</h3>

            <div class="product-pricing">
              <span class="current-price"
                >{{ product.minPrice.toLocaleString("vi-VN") }} -
                {{ product.maxPrice.toLocaleString("vi-VN") }} ₫</span
              >
            </div>

            <button
              (click)="addToCart(product)"
              class="add-to-cart-btn"
              [disabled]="product.badge === 'Out of Stock'"
            >
              {{
                product.badge === "Out of Stock"
                  ? "Out of Stock"
                  : "Add to Cart"
              }}
            </button>
          </div>
        </div>
      </div>

      <!-- Pagination -->
      <div class="pagination" *ngIf="totalPages > 1">
        <button
          class="page-btn"
          [disabled]="currentPage === 1"
          (click)="previousPage()"
        >
          Previous
        </button>

        <button
          *ngFor="let page of getPageNumbers()"
          class="page-btn"
          [class.active]="page === currentPage"
          (click)="goToPage(page)"
        >
          {{ page }}
        </button>

        <button
          class="page-btn"
          [disabled]="currentPage === totalPages"
          (click)="nextPage()"
        >
          Next
        </button>
      </div>
    </main>
  </div>
</div>
